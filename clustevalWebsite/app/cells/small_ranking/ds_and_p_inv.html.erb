<div class="resizable" style="height:400px; width:100%;">
  <div id="comparison_chart">
  </div>
</div>
<br>
<div class="resizableTable">
<table id="dataAndProgramStatistics" class="display">
  <thead>
  <tr>
    <th>Program</th>
    <% for i in 0..@datasets.length-1 %>
    <% dataset = @datasets[i] %>
    <th>
      <%= dataset.alias %>
</th>
    <% end %>
  </tr>
 </thead>
 <tbody>
</tbody>
</table>
</div>

<script type="text/javascript">
$(function () {
    var chart;

        $('#dataAndProgramStatistics').dataTable({
          sPaginationType: "full_numbers",
          bDeferRender: true,
          bJQueryUI: true,
          bRetrieve: true,
          bPaginate: false,
          bInfo: false,
          bFilter: false,
          bAutoWidth: false,
          oTableTools: {
            sSwfPath: "/assets/dataTables/copy_csv_xls.swf",
            aButtons: ['copy', 'csv']
          },
          sAjaxSource: '/mains/comparison_table_data_inverse/<%= @qualityMeasure.id %>'
        });

        chart = new Highcharts.Chart({
    
            chart: {
                renderTo: 'comparison_chart',
                type: 'column'
            },
    
            title: {
                text: 'Clustering qualities'
            },
    
            xAxis: {
                categories: [<% Program.all(session).sort_by{|x| x.alias}.each do |program| %><% if @visiblePrograms[program] %>'<%= program.alias %>',<% end %><% end %>],
                labels: {
                  enabled: true,
                  rotation: -45,
                  align: 'right'
                }
            },
            yAxis: {
                title: {
                    text: '<%= @qualityMeasure.alias %>'
                },
                min: <%= @qualityMeasure.minValue %>,
                max: <%= @qualityMeasure.maxValue %>,
            },
    
            tooltip: {
                formatter: function() {
                    return '<b>'+ this.x +'</b><br/>'+
                        this.series.name +': '+ this.y;
                }
            },
            plotOptions: {
              column: {
                borderWidth: 1,
                borderColor: '#000000',
                pointPadding: 0,
                shadow: false
              },
              series: {
              }
            },
            series: [
<% Dataset.all(session).sort_by{|x| x.alias}.each do |dataset| %>
<% if @visibleDatasets[dataset] %>
{
  name: '<%= dataset.alias %>',
  data: [<% Program.all(session).sort_by{|x| x.alias}.each do |program| %>
  <% if @visiblePrograms[program] %>
    <% @qual = @matrix[@programIds[program]][@datasetIds[dataset]] %>
    <% if @qual != "--" %>
      <%= @qual %>
    <% else %>
      null
    <% end %>,<% end %><% end %>]
},
<% end %>
<% end %>
            ]
        });

      $( ".resizable" ).resizable({
        helper: "ui-resizable-helper",
        create: function( event, ui ) {
          chart.setSize(ui.size.width,ui.size.height,doAnimation = true);
        },
        stop: function( event, ui ) {
          chart.setSize(ui.size.width,ui.size.height,doAnimation = true);
        }
      });

      $( ".resizableTable" ).resizable({
        helper: "ui-resizable-helper"
      });
});
</script>